{% extends 'base.html' %}

{% block content %}
  {% if user.is_authenticated %}

  <style>
    #removeButton {
    margin-top: 10px; /* Adjust as necessary for your layout */
    padding: .25rem .80rem; /* Similar padding to bootstrap's btn class */
    border-radius: .25rem; /* Rounded borders */
    border: 1px solid #ced4da; /* Similar to default file input button */
    cursor: pointer; /* Pointer cursor on hover */
    font-size: 0.9rem; /* Adjust font size as needed */
    line-height: 0.9; /* For proper text alignment */
    transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, box-shadow .15s ease-in-out; /* Smooth transition for hover effects */
}
    .custom-checkbox {
    display: inline-block;
    cursor: pointer;
}

.custom-checkbox .checkmark {
    display: inline-block;
    width: 15px;
    height: 15px;
    background: #eee;
    border: 1px solid #ddd;
    position: relative;
}

/* When the checkbox is checked, add an 'x' */
.custom-checkbox input:checked + .checkmark::after {
    content: 'Ã—'; /* Unicode character for 'x' */
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: black;
    font-size: 18px;
}
  #example th {
    text-align: center;
  }
  #example td:nth-child(1){
    text-align: center;
    width: 4%;
  }
  #example td:nth-child(2){
    text-align: left;
    width: 20%;
  }
  #example td:nth-child(3){
    text-align: center;
    width: 2%;

  }
  #example td:nth-child(4){
    text-align: center;
    width: 2%;

  }
  #example td:nth-child(5){
    text-align: center;
    width: 2%;

  }
  #example td:nth-child(6){
    text-align: center;
    width: 5%;

  }
  #example td:nth-child(7){
    text-align: center;
    width: 8%;

  }
  #example td:nth-child(8){
    text-align: center;
    width: 5%;

  }

  #example td:nth-child(9){
    text-align: center;
    width: 8%;

  }
  #example td:nth-child(12){
    text-align: center;
    width: 44%;

  }
  #example td:nth-child(10){
    text-align: center;
  }
  #example td:nth-child(12){
    text-align: center;
  }
  </style>
        <div class="col-lg-14 mx-auto">
          <div class="card rounded shadow border-0">
            <div class="card-body p-5 bg-white rounded">
              <div >
                  <table id="example"class="table table-striped table-bordered">
                    <thead>
                      <tr>
                        <th>NO</th>
                        <th>WORK ORDERS</th>
                        <th>PA</th>
                        <th>PD</th>
                        <th>CEO</th>
                        <th>FINANCE</th>
                        <th>REQUEST FORM</th>
                        <th>EDIT WO</th>
                        <th>CONFIRM CHECK</th>
                        <th>REJECTION</th>
                        <th>REMARKS</th>
                        <th>PAYMENT DATE</th>
                        <th>DUE DATE</th>
                        <th>PROOF OF PAYMENT</th>
                        <th>DELETE WO</th>



                      </tr>
                    </thead>
                    <tbody>
                      {% for order in page_obj %}
                      <form method = "post" enctype="multipart/form-data">
                        {% csrf_token%}
                        <tr>
                          <td>
                            {{ forloop.counter|add:starting_index }}                         
                           </td>

                          <!-- CHECK ACI / BKS AND SET THEM CORRESPONDINGLY-->
                      
                          <td>
                            <input type="hidden" name="order" value="{{ order.id }}">
                            <input type="hidden" name="order_category" value="{{ order.category }}">
                            <input type="hidden" name="order_company" value="{{ order.company }}">
                            <input type="hidden" name="order_project" value="{{ order.project }}">
                            <a href="{% url 'view_wo' order.id order.category order.company order.project%}">{{ order.wo_string }}</a>
                          </td>
                          <td>
                            <label class="container">
                              <input type="checkbox" {%if is_pa%}name="paCheck"{%endif%} {% if order.personalAssistantCheck %}checked="checked"{% endif %} {% if not is_pa %}disabled{% endif %}>

                              <span class="checkmark"></span>
                            </label>
                            <label class="custom-checkbox">
                              <input hidden type="checkbox" {%if is_pa%}name="paReject"{%endif%} {% if order.personalAssistantReject %}checked="checked"{% endif %} {% if not is_pa %}disabled{% endif %}>
                              <span class="checkmark"></span>
                            </label>

                          </td>
                          <td>
                            <label class="container">
                              <input type="checkbox" {%if is_rightHand%}name="rightHandCheck"{%endif%}{% if order.rightHandCheck %}checked="checked"{% endif %} {% if not is_rightHand %}disabled{% endif %}>
                              <span class="checkmark"></span>

                            </label>

                              <label class="custom-checkbox">
                                <input hidden type="checkbox" {%if is_rightHand%}name="rightHandReject"{%endif%} {% if order.rightHandReject %}checked="checked"{% endif %} {% if not is_rightHand %}disabled{% endif %}>
                                <span class="checkmark">
                                </span>
                            </label>
                          </td>
                          <td>
                            <label class="container">
                              <input type="checkbox" {%if is_ceo%}name="ceoCheck"{%endif%}{% if order.ceoCheck %}checked="checked"{% endif %} {% if not is_ceo %}disabled{% endif %}>

                            </label>
                            <label class="custom-checkbox">
                              <input hidden type="checkbox" {%if is_ceo%}name="ceoReject"{%endif%}{% if order.ceoReject %}checked="checked"{% endif %} {% if not is_ceo %}disabled{% endif %}>
                              <span class="checkmark"></span>
                            </label>
                          </td>
                          <td>
                            <label class="container">
                              <input type="checkbox" 
                              {% if is_finance and order.ceoCheck and order.rightHandCheck and order.personalAssistantCheck  %}name="financeCheck" {% endif %} 
                              
                              {% if order.financeCheck %}checked="checked"{% endif %} 
                              {% if not is_finance or not order.ceoCheck or not order.rightHandCheck or not order.personalAssistantCheck or not order.paymentDate %}disabled{% endif %}>        

                            </label>
                            <label class="custom-checkbox">
                              <input hidden type="checkbox" {%if is_finance%}name="financeReject"{%endif%}{% if order.financeReject %}checked="checked"{% endif %} {% if not is_finance %}disabled{% endif %}>
            
                              <span class="checkmark"></span>
                            </label>
                            </td>
                          <td>
                            <input type="hidden" name="order" value="{{ order.id }}">
                            <input type="hidden" name="order_category" value="{{ order.category }}">
                            <input type="hidden" name="order_company" value="{{ order.company }}">
                            <input type="hidden" name="order_project" value="{{ order.project }}">
                            <a href="{% url 'request_form' order.id order.category order.company order.project %}">Request Form</a>
                          </td>
                          <td>
                            <input type="hidden" name="order" value="{{ order.id }}">
                            <input type="hidden" name="order_category" value="{{ order.category }}">
                            <input type="hidden" name="order_project" value="{{ order.project }}">
                            <a href="{% url 'edit_wo' order.id order.category order.project%}">Edit WO</a>
                          </td>
                          <td>
                            <button type="submit" name="action" value="confirm"> CONFIRM </button>
                          </td>
                          <td>
                            <button type="submit" name="action" value="reject"> REJECT </button>
                          </td>
    
                          <td>
                            {% if is_pa or is_rightHand or is_ceo or is_finance %}
                              <textarea name="remarksOverview" style="width: 100%;">{{ order.remarksOverview }}</textarea>
                            {% else %}
                              <textarea name="remarksOverview" disabled style="width: 100%;">{{ order.remarksOverview }}</textarea>
                            {% endif %}
                          </td>
                          <td>
                            <input type ="date" id ="paymentDate" name ="paymentDate" value ="{{order.paymentDate |date:'Y-m-d'}}">
                           </td>
                           <td>
                            <input type ="date" id ="dueDate" name ="dueDate" value ="{{order.dueDate |date:'Y-m-d'}}">
                           </td>
                           <td>
                            {% if order.proofOfPayment %}
                            <a href="{{ order.proofOfPayment.url }}">Download Attachment</a>
                            <input type="file" name="proofOfPayment" id="proofOfPayment">
                          {% else %}
                            No attachment
                            <input type="file" name="proofOfPayment" id="proofOfPayment">
                            <button type="button" onclick="clearFileInput('proofOfPayment')" id="removeButton">Remove</button>
                          {% endif %}
                           </td>
                          <td>
                            <input type="hidden" name="order" value="{{ order.id }}">
                            <button type="submit" name="action" value="delete" onclick="return confirm('Delete Work Order?')"> DELETE </button>
                          </td>
                          
                          
                        </tr>                        
                      </form>
                      {% empty %}
                      <tr>
                        <td>1</td>
                        <td>No work orders available.</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>

                      </tr>
                       {% endfor %}
                    </tbody>
                </table>
              
                  <!-- Pagination Links -->
                  <div class="pagination">
                    <span class="step-links">
                        {% if page_obj.has_previous %}
                            <a href="?page=1">&laquo; first</a>
                            <a href="?page={{ page_obj.previous_page_number }}">previous</a>
                        {% endif %}

                        <span class="current">
                            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
                        </span>

                        {% if page_obj.has_next %}
                            <a href="?page={{ page_obj.next_page_number }}">next</a>
                            <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
                        {% endif %}
                    </span>
                  </div>
              </div>
      </div>
    </div>
    <script>
      // Define the function in the global scope so it's always available
      function clearFileInput(id) {
        var input = document.getElementById(id);
        if (input) {
          input.value = "";
        }
      }
    </script>
  {% else %}
    {% with 'login' as login_url %}
      {% load static %}
      {% load i18n %}
      {% load tz %}

      <script>
  window.location.href = "{% url login_url %}";
      </script>

    {% endwith %}
  {% endif %}
{% endblock %}
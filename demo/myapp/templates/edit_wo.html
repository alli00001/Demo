<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
{% extends 'base.html' %}

{% block title %}
Create New List
{% endblock %}

{% block content %}
<style>
	/*
	Common invoice styles. These styles will work in a browser or using the HTML
	to PDF anvil endpoint.
*/
.general-information-table {
  table-layout: fixed;
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

.general-information-table td {
    padding: 8px;
    vertical-align: middle;
	
}

.general-information-table input[type="text"], 
.general-information-table input[type="date"] {
    width: 100%;
    padding: 6px;
    border-radius: 4px;
    border: 1px solid #ccc;
    box-sizing: border-box; /* Include padding in width */
	text-align: left;
}

.general-information-table tr:nth-child(even) {
    background-color: #f2f2f2; /* Zebra striping for rows */
}

.general-information-table td:nth-child(1) {
    text-align: left;
    width: 25%;
}

.general-information-table td:nth-child(2) {
    width: 25%;
}

.general-information-table td:nth-child(3), 
.general-information-table td:nth-child(4) {
    text-align: right;
    width: 25%;
}
	.line-items-container {
  table-layout: fixed;
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

.line-items-container, .line-items-container th, .line-items-container td {
  border: 1px solid #ddd;
  text-align: center;
  padding: 8px;
}

.line-items-container th {
  background-color: #999;
  color: white;
  text-align: center;
}

.line-items-container select,
.line-items-container input {
    width: 100%; /* Will fill the cell */
    box-sizing: border-box; /* Include padding and border in the width */
}

@media screen and (max-width: 600px) {
  .line-items-container, .line-items-container thead, .line-items-container tbody, .line-items-container th, .line-items-container td, .line-items-container tr {
    text-align: center;
	display: block;
  }

  .line-items-container thead tr {
    text-align: j;
    top: -9999px;
    left: -9999px;
  }

  .line-items-container tr {
    margin: 0 0 1rem 0;
  }

  .line-items-container td {
    border: none;
    position: relative;
    padding-left: 50%;
  }

  .line-items-container td:before {
    position: absolute;
    top: 6px;
    left: 6px;
    width: 45%;
    padding-right: 10px;
    white-space: nowrap;
    content: attr(name);
  }
}

	.payment-info {
		width: 38%;
		font-size: 0.75em;
		line-height: 1.5;
	}

	.footer {
		margin-top: 100px;
	}


	.footer-info {
		float: right;
		margin-top: 5px;
		font-size: 0.75em;
		color: #ccc;
	}

	.footer-info span {
		padding: 0 5px;
		color: black;
	}

	.add-new-button {
		background-color: white;
		border: 2px solid #008CBA;
	}

	.add-new-button:hover {
		background-color: #008CBA;
		color: white;
	}

	.payment-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

.payment-table, .payment-table th, .payment-table td {
  border: 1px solid #ddd;
  text-align: left;
  padding: 8px;
}

.payment-table th {
  background-color: #999;
  color: white;
}

.payment-table td input[type="text"], .payment-table td select {
  width: 100%;
  padding: 5px;
  margin: 4px 0;
  box-sizing: border-box;
  border: 1px solid #ccc;
  border-radius: 4px;
}


@media screen and (max-width: 600px) {
  .payment-table, .payment-table thead, .payment-table tbody, .payment-table th, .payment-table td, .payment-table tr {
    display: block;
  }

  .payment-table thead tr {
    position: absolute;
    top: -9999px;
    left: -9999px;
  }

  .payment-table tr {
    margin: 0 0 1rem 0;
  }

  .payment-table td {
    border: none;
    position: relative;
    padding-left: 50%;
  }

  .payment-table td:before {
    position: absolute;
    top: 6px;
    left: 6px;
    width: 45%;
    padding-right: 10px;
    white-space: nowrap;
  }

  .payment-table td:nth-of-type(1):before { content: "PAYMENT"; }
  .payment-table td:nth-of-type(2):before { content: "PERCENTAGE"; }
  .payment-table td:nth-of-type(3):before { content: "AMOUNT"; }
  .payment-table td:nth-of-type(4):before { content: "REMARKS"; }
}



</style>
<form id="workOrder" , method="post" enctype="multipart/form-data">
	{% csrf_token %}
	<!-- Company Logo -->
	<div style="text-align: center; background-color: white"  >
		<img  src="{{MEDIA_URL}}bks4.png">
	  </div>
	  
	<!-- Title Text -->

	<div style="text-align: center; font-size: 2.0em;">
		<b>PT. BAHTERA KONSTRUKSI SEJAHTERA</b>
	</div>
	<div style="text-align: center; font-size: 2.5em;">
		<b>WORK ORDER</b>
	</div>
	<table class = "general-information-table" border="1" >
		<tr>
			<td style="width: 18%;">DATE</td>
			<td style="width: 2%; text-align: center;">:</td>
			<td style="width: 20%; text-align: left;" ><input type ="date" name="wo_date" id ="wo_date" type="date" style="text-align: left; height: 30px" value ="{{ order.wo_date|date:'Y-m-d' }}"/></td>
			
			<td style ="width:10%"></td>

			<td style ="width:18%">WO NUMBER</td>
			<td style="width: 2%;">:</td>
			<td style ="width:30%">WO / BKS / EMR / <input name ="shortdate" id ="shortdate" type ="text" value="{{order.shortdate}}" style="width: 10%; height: 30px; text-align: center;" readonly> / <input value="{{order.wo_number}}" name="wo_number" id = "wo_number" type="number" style="text-align: right; height: 30px; width: 20%;" min = "0" max = "9999" maxlength="4"></td>
		</tr>
		<tr>
			<td style="width: 18%;">REQUEST BY</td>
			<td style="width: 2%; text-align: center;">:</td>
			<td style="width: 20%; text-align: left;"><input text-transform: uppercase; name="request_by" type="text" style="text-align: left; height: 30px;" value="{{order.request_by}}"></td >
			<td style ="width:20%">
				
			<td>CATEGORY</td>
			<td style="width: 2%;">:</td>
			<td style ="width:20%"><input  name="category" type="text" style="text-align: left; height: 30px;" value="MP"></td>
		</tr>
		<tr>
			<td style="text-align: left; width: 25px;">PROJECT</td>
			<td>:</td>
			<td style="text-align: left;"><input name="project" type="text" style=" height : 30px" value="EMR"> </strong></td>
			<td></td>

			<td>BANK</td>
			<td>:</td>
			<td style="text-align: left;">
                <select id="bank" name="bank" style="text-align: left; height: 30px; width: 100%;">
                    <option value="BCA" {% if order.bank == 'BCA' %}selected{% endif %}>BCA</option>
                    <option value="MANDIRI" {% if order.bank == 'MANDIRI' %}selected{% endif %}>MANDIRI</option>
                    <option value="OCBC NISP" {% if order.bank == 'OCBC NISP' %}selected{% endif %}>OCBC</option>
                    <option value="BRI" {% if order.bank == 'BRI' %}selected{% endif %}>BRI</option>
                    <option value="CREATE">CREATE</option>
                </select>
			</td>
		</tr>
		<tr>
			<td style="text-align: left;">CUSTOMER</td>
			<td>:</td>
			<td style="text-align: left;">
				<select id ="customer"name="customer" style="height : 30px ; width:100%;">
					<option value = "ZTE"  {% if order.customer == 'ZTE' %}selected{% endif %}>ZTE</option>
					<option value = "YOFC"  {% if order.customer == 'YOFC' %}selected{% endif %}>YOFC</option>
					<option value = "FH"  {% if order.customer == 'FH' %}selected{% endif %}>FH</option>
					<option value="CREATE">CREATE</option>
			</td>

			<td></td>

			<td style="text-align: left;height: 30px;">ACCOUNT NAME</td>
			<td>:</td>
			<td style="text-align: left;"><input name="account-name" type="text" style="height : 30px ;" value="{{order.account_name}}"></td>
		</tr>
		<tr>
			<td style="text-align: left; width: 25px;">DEPARTMENT</td>
			<td>:</td>
			<td style="text-align: left;"><input name="department" type="text" style=" height : 30px" value="PROJECT"></td>

			<td></td>

			<td style="text-align: left">ACCOUNT NUMBER</td>
			<td>:</td>
			<td style="text-align: left;"><input name="account-number" type="text" style="height : 30px" value ="{{order.account_number}}"></td>
		</tr>
		<tr>
			<td style="text-align: left; width: 25px;">REGION</td>
			<td>:</td>
			<td style="text-align: left;"><select id ="region" name="region" style=" height : 30px ;width: 100% ;">
				<option value="JABO"  {% if order.region == 'JABO' %}selected{% endif %}>JABO</option>
				<option value="CJ"  {% if order.bank == 'CJ' %}selected{% endif %}>CJ</option>
				<option value="EJ"  {% if order.bank == 'EJ' %}selected{% endif %}>EJ</option>
				<option value="WJ"  {% if order.bank == 'WJ' %}selected{% endif %}>WJ</option>
				<option value="CREATE">CREATE</option>

			</td>

			<td></td>

			<td style="text-align: left">PHONE NUMBER</td>
			<td>:</td>
			<td style="text-align: left;"><input name="phone_number" type="text" style="height : 30px" value="{{order.phone_number}}"></td>
		</tr>
		<tr>
			<td style="text-align: left; width: 25px;">CITY</td>
			<td>:</td>
			<td style="text-align: left;"><input name="city" type="text" style=" height : 30px"></td>

			<td></td>

			<td style="text-align: left">NPWP</td>
			<td>:</td>
			<td style="text-align: left;"><input name="npwp" type="text" style="height : 30px" value="{{order.npwp}}"></td>
		</tr>
	</table>

	<div class="table-container">
		<table class="line-items-container">
			<thead>
				<tr>
					<th class="heading-description" style ="width : 20%" >CLUSTER NAME</th>
					<th class="heading-description" style ="width : 20%">SITE ID</th>
					<th class="heading-description" style ="width : 20%">TYPE</th>
					<th class="heading-description" style ="width : 20%">WORK TYPE</th>
					<th class="heading-description" style ="width : 20%">HP</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><input type="text" class="clusterName" name="clusterName" value="{{order.clusterName}}"></td>
					<td><input type="text" class="siteId" name="siteId" value="{{order.siteId}}"></td>
					<td><input type="text" class="type" name="type" value ="{{order.type}}"></td>
					<td><input type="text" class="workType" name="workType" value ="{{order.workType}}"></td>
					<td><input type="text" class="HP" name="hp" value="{{order.hp}}"></td>
				</tr>
			</tbody>
		</table>
	</div>
	
	<button class="button add-new-button" onclick=add() type="button">+</button>
	<table class="line-items-container" id="scopeOfWork" >
		<thead>
			<tr>
				<th style ="width : 4%">NO</th>
				<th style ="width: 28%;">SCOPE OF WORK</th>
				<th style ="width : 9%">QTY (BOQ)</th>
				<th style ="width : 9%">QTY (ACTUAL)</th>
				<th style ="width : 10%">UNIT PRICE</th>
				<th style ="width : 10%">TOTAL (BOQ)</th>
				<th style ="width : 10%">TOTAL (ACTUAL)</th>
				<th style ="width : 20%">REMARKS</th>
				<th style ="width : 0%;"></th>
			</tr>
		</thead>
		<tbody>
            {%for scope in order.workOrder.all%}
      <tr>
        <td style = "text-align: center;" class="line-items-container">{{ forloop.counter }}</td> <!-- This will auto-increment the row number -->
        <td style="text-align: left;"><select style="text-align: left;" class="line-items-container" name ="scopeOfWork_{{ forloop.counter|add:"-1" }}">
            <option value ="Pulling Cable-24 core (AE) include install the Accessory" data-price = 2500  {% if scope.scopeOfWork == 'Pulling Cable-24 core (AE) include install the Accessory' %}selected{% endif %}>Pulling Cable-24 core (AE) include install the Accessory</option>
            <option value ="Pulling Cable-48 core (AE) include install the Accessory" data-price = 2500  {% if scope.scopeOfWork == 'Pulling Cable-48 core (AE) include install the Accessory' %}selected{% endif %}>Pulling Cable-24 core (AE) include install the Accessory</option>
            <option value ="Pulling Cable-96 core (AE) include install the Accessory" data-price = 2500  {% if scope.scopeOfWork == 'Pulling Cable-96 core (AE) include install the Accessory' %}selected{% endif %}>Pulling Cable-24 core (AE) include install the Accessory</option>
            <option value ="Pulling Cable-144 core (AE) include install the Accessory" data-price = 3000  {% if scope.scopeOfWork == 'Pulling Cable-144 core (AE) include install the Accessory' %}selected{% endif %}>Pulling Cable-24 core (AE) include install the Accessory</option>
            <option value ="Instal Label Cable (on pole, in Handhole)" data-price = 2000  {% if scope.scopeOfWork == 'Instal Label Cable (on pole, in Handhole)' %}selected{% endif %}>Instal Label Cable (on pole, in Handhole)</option>
            <option value ="Instal Label FDT" data-price = 2000 {% if scope.scopeOfWork == 'Instal Label FDT' %}selected{% endif %}>Instal Label FDT</option>
            <option value ="Instal Label FAT" data-price = 2000 {% if scope.scopeOfWork == 'Instal Label FAT' %}selected{% endif %}>Instal Label FAT</option>
            <option value ="Instal Label Pole" data-price = 2000 {% if scope.scopeOfWork == 'Instal Label Pole' %}selected{% endif %}>Instal Label Pole</option>
            <option value ="Instal pole 7 & 9 meter 4 inch include the foundation" data-price = 135000 {% if scope.scopeOfWork == 'Instal pole 7 & 9 meter 4 inch include the foundation' %}selected{% endif %}>Instal pole 7 & 9 meter 4 inch include the foundation</option>
            <option value ="Instal pole 7 meter 3 inch include the foundation" data-price = 130000 {% if scope.scopeOfWork == 'Instal pole 7 meter 3 inch include the foundation' %}selected{% endif %}>Instal pole 7 meter 3 inch include the foundation</option>
            <option value ="Instal Cable Hanger" data-price = 20000 {% if scope.scopeOfWork == 'Instal Cable Hanger' %}selected{% endif %}>Instal Cable Hanger</option>
            <option value ="Instal sling Wire" data-price = 2500 {% if scope.scopeOfWork == 'Instal sling Wire' %}selected{% endif %}>Instal sling Wire</option>
            <option value ="Instal FDT" data-price = 130000 {% if scope.scopeOfWork == 'Instal FDT' %}selected{% endif %}>Instal FDT</option>
            <option value ="Instal FAT inclde the Splicing & Splitter" data-price = 150000 {% if scope.scopeOfWork == 'Instal FAT inclde the Splicing & Splitter' %}selected{% endif %}>Instal FAT inclde the Splicing & Splitter</option>
            <option value ="Splicing" data-price = 20000 {% if scope.scopeOfWork == 'Splicing' %}selected{% endif %}>Splicing</option>
        </select></td>
        <td><input class="line-items-container" type="number" name ="qtyB_{{ forloop.counter|add:"-1" }}" value="{{ scope.qtyBoq }}"></td>
        <td><input class="line-items-container" type="number" name ="qtyA_{{ forloop.counter|add:"-1" }}" value="{{ scope.qtyActual }}"></td>
        <td><input class="line-items-container" type ="text"name ="unitPrice_{{ forloop.counter|add:"-1" }}" value="{{ scope.unitPrice }}"></td>
        <td><input class="line-items-container" type="text" name ="totalB_{{ forloop.counter|add:"-1" }}" value="{{ scope.totalBoq }}"></td>
        <td><input class="line-items-container" type="text" name ="totalA_{{ forloop.counter|add:"-1" }}" value="{{ scope.totalActual }}"></td>
        <td><input class="line-items-container" type="text" name ="remarks_{{ forloop.counter|add:"-1" }}" value="{{ scope.remarks }}"></td>
        <td><button class ="button add-new-button removeRowButton" id ="removeRow" >-</button></td>       
      </tr>
      {%endfor%}
		</tbody>
		<tfoot> 
			<tr>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
                <td id="grand-total-boq"><input type = "text" name ="grand-total-boq" value = "{{order.grandTotalBoq}}"></td>
				<td id="grand-total-actual"> <input type = "text" name ="grand-total-actual" value = "{{order.grandTotalActual}}"></td>
				<td></td> 
				<td></td>
			</tr>
		</tfoot>
	</table>


  <!-- PAYMENT -->
  <div style="margin-top: 50px;">
    <button class="button add-new-button" onclick=addDeduction() type="button">+</button>
    <table class="line-items-container" id ="payment-table" border="1">
      <thead>
        <th style ="width : 25%">PAYMENT</th>
        <th style ="width : 25%">PERCENTAGE</th>
        <th style ="width : 25%">AMOUNT</th>
        <th style ="width : 25%">REMARKS</th>
      </thead>
      <tbody>
        <tr>
          <td>TOTAL</td>
          <td></td>
          <td id ="grand-total-payment"> <input type = "text" name ="grand-total-payment" value = "{{order.totalAmount}}"></td>
          <td></td>
        </tr>
        <tr>
          <td>
            <select name = "terms-selection" id ="terms-selection">
            <option value = "DP" data-percentage-amount =30% {% if order.paymentTerm == 'DP' %}selected{% endif %}> DP </option>
            <option  value ="TERM 2 - Implementation Done" data-percentage-amount =40% {% if order.paymentTerm == 'TERM 2 - Implementation Done' %}selected{% endif %}>TERM 2 - Implementation Done</option>
            <option  value ="TERM 3 - ATP Done" data-percentage-amount =20% {% if order.paymentTerm == 'TERM 3 - ATP Done' %}selected{% endif %}>TERM 3 - ATP Done</option>
            <option  value ="TERM 4 - FAC Done" data-percentage-amount =10% {% if order.paymentTerm == 'TERM 4 - FAC Done' %}selected{% endif %}>TERM 4 - FAC Done</option>
            <option  value ="CASHBON" data-percentage-amount =0% {% if order.paymentTerm == 'CASHBON' %}selected{% endif %}>CASHBON</option>
            <option  value ="FULL" data-percentage-amount = 100% {% if order.paymentTerm == 'FULL' %}selected{% endif %} >FULL</option>
            <option  value ="REMAINING" data-percentage-amount =0% {% if order.paymentTerm == 'REMAINING' %}selected{% endif %}>REMAINING</option>
            <option  value ="CREATE" data-percentage-amount = 0%>CREATE</option>  
            </select>
            </td>
			<td><input type="text" id="terms-percentage-cell" name="terms-percentage-cell" value="{{order.termPercentage}}"></td>          
			<td id = "terms-amount-cell"><input type="text" id="terms-amount-cell" name="terms-amount-cell" value="{{order.termAmount}}"></td>
          <td style = "text-align: left;">
			<input type ="text" name ="payment-remarks-cell" value="{{order.termRemark}}">
		  </td>
        </tr>
        <tr>
          <td>
			<select name ="tax-cell" id ="tax-cell">
				<option value ="wht-21" data-tax-percentage-amount = 2.5% {% if order.paymentTax == 'wht-21' %}selected{% endif %}>TAX - WHT21</option>
				<option value ="wht-23" data-tax-percentage-amount = 3% {% if order.paymentTax == 'wht-23' %}selected{% endif %}>TAX - WHT23</option>
				<option value ="vat" data-tax-percentage-amount = 11% {% if order.paymentTax == 'vat' %}selected{% endif %}>TAX - VAT</option>
			</select>
		</td>
          <td>
			<input type="text" id="tax-percentage-cell" name="tax-percentage-cell" value="{{prder.taxPercentage}}">       
		  </td>
          <td id = "tax-amount-cell"> <input type="text" id="tax-amount-cell" name="tax-amount-cell" value="{{order.taxAmount}}"></td>
          <td style = "text-align: left;"	>
			<input type ="text" name ="tax-remarks-cell" value="{{order.taxRemark}}">
		  </td>
        </tr>
        
        <tr id ="deduction-row">
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td> GRAND TOTAL </td>
          <td></td>
          <td id = "grand-total-payment2"><input type = "text" name ="grand-total-payment2" value = "{{order.finalGrandTotal}}"></td>
          <td></td>
        </tr>
      </tfoot>
    </table>
  </div>
  
    <!-- TERM PAYMENT -->

  <table class="line-items-container"border="1">	
    <thead>
      <th>PAYMENT TYPE</th>
      <th>PERCENTAGE</th>
      <th>AMOUNT</th>
      <th>STATUS</th>
      <th>DATE</th>
    </thead>
    <tbody>
      <td id ="payment-type">  <input type = "text" name ="payment-type" value = "{{order.paymentSteps}}"></td>
	  <td id ="percentage-payment-type"><input type = "text" name ="percentage-payment-type" value = "{{order.percentageAmount}}"></td>
	  <td id = "amount-payment-type"> <input type = "text" name ="amount-payment-type" value = "{{order.amount}}"></td>
	  <td id ="status-payment-type">
		<select name ="status-payment-type" id ="status-payment-type">
			<option value ="DONE" {% if order.status == 'DONE' %}selected{% endif %}>DONE</option>
			<option value ="REQUEST"{% if order.status == 'REQUEST' %}selected{% endif %}>REQUEST</option>
		</select>
	  </td>
	  <td ><input type = "date" name ="date-payment-type" value = "{{order.date |date:'Y-m-d' }}" id = "date-payment-type"></td>
    </tbody>
  </table>

  <!-- DOCUMENT -->
  <table class="line-items-container"border="1">
    <thead>
      <th>DOCUMENT</th>
	  <th>STATUS</th>
    </thead>
	<tbody>
		<tr>
			<td>TEAM LIST</td>
			<td>
				<select name = "tl" id ="tl">
					<option value="RECEIVED"{% if order.tl == 'RECEIVED' %}selected{% endif %}>RECEIVED</option>
					<option value ="NY RECEIVED"{% if order.tl == 'NY RECEIVED' %}selected{% endif %}>NY RECEIVED</option>
				</select>
			</td>
		</tr>
		<tr>
			<td>PICTURE OF TEAM READY ON SITE					
			</td>
			<td>
				<select name = "pic" id ="pic">
					<option value="RECEIVED"{% if order.pic == 'RECEIVED' %}selected{% endif %}>RECEIVED</option>
					<option value ="NY RECEIVED"{% if order.pic == 'NY RECEIVED' %}selected{% endif %}>NY RECEIVED</option>
				</select>
			</td>
		</tr>		
		<tr>
			<td>CHECKLIST BOQ ACTUAL</td>
			<td>
				{% if order.checklist_boq_actual_attachment %}
					<a href="{{ order.checklist_boq_actual_attachment.url }}">Download Attachment</a>
					<input type="file" name="checklist_boq_actual_attachment">
				{% else %}
					No attachment
					<input type="file" name="checklist_boq_actual_attachment">
				{% endif %}
			</td>
		</tr>	
		<tr>
			<td>COVER ACCEPTANCE SIGN BY CUSTOMER, PROJECT & COMPANY					
			</td>
			<td>
				{% if order.cover_acceptance_attachment %}
					<a href="{{ order.cover_acceptance_attachment.url }}">Download Attachment</a>
					<input type="file" name="cover_acceptance_attachment">
				{% else %}
					No attachment
					<input type="file" name="cover_acceptance_attachment">
				{% endif %}
			</td>
		</tr>		<tr>
			<td>COVER OPM & OTDR TEST					
			</td>
			<td>
				{% if order.cover_opm_attachment %}
					<a href="{{ order.cover_opm_attachment.url }}">Download Attachment</a>
					<input type="file" name="cover_opm_attachment">
				{% else %}
					No attachment
					<input type="file" name="cover_opm_attachment">
				{% endif %}
			</td>
		</tr>		
		<tr>
			<td>FAC CERTIFICATE					
			</td>
			<td>
				<select name = "fac-certificate" id ="fac-certificate">
					<option value="RECEIVED"{% if order.FACcert == 'RECEIVED' %}selected{% endif %}>RECEIVED</option>
					<option value ="NY RECEIVED"{% if order.FACcert == 'NY RECEIVED' %}selected{% endif %}>NY RECEIVED</option>
				</select>
			</td>
		</tr>		
		<tr>
			<td>NO ISSUE AGGREEMENT					
			</td>
			<td>
				<select name = "noise" id ="noise">
					<option value="RECEIVED"{% if order.NoIssAgr == 'RECEIVED' %}selected{% endif %}>RECEIVED</option>
					<option value ="NY RECEIVED"{% if order.NoIssAgr == 'NY RECEIVED' %}selected{% endif %}>NY RECEIVED</option>
					<option value ="NONE"{% if order.NoIssAgr == 'NONE' %}selected{% endif %}>NONE</option>
				</select>
			</td>
		</tr>
	</tbody>
  </table>

  <!-- SIGN FIELD -->
  <table class="line-items-container" border="1">
    <thead>
      <th>CREATED BY</th>
      <th>APPROVED BY</th>
    </thead>
    <tbody>
      <tr><td><td></td></td></tr>
      <tr><td><td></td></td></tr>
      <tr><td>ELSA MONICA</td><td>JENNY</td></tr>
      <tr><td>PROCUREMENT</td><td>CEO</td></tr>

    </tbody>
  </table>

	<div class="footer">
		<div class="footer-info">
			<span>hello@useanvil.com</span> |
			<span>555 444 6666</span> |
			<span>useanvil.com</span>
		</div>
		<!--template for generating row-->
		<div id="new-row">
			<p>Grand Total: <span id="grandTotal">0</span></p>

		</div>
		<button onclick="generatePDF(event)" type="button" class="generatePDFButton">Generate PDF</button>
	</div>

	<div>
		<button type="submit"> Submit </button>
	</div>
	<input type="number" id="number_of_scopes" name="number_of_scopes" value="{{ order.scopeOfWorkCount }}" style="display: none;" >
	<input type="number" id="number_of_deduction" name="number_of_deduction" value="{{ order.deductionCount }}" style="display: none;">

</form>

<script type="text/javascript">
	document.addEventListener('DOMContentLoaded', function() {
		document.getElementById('number_of_scopes').value = "{{ order.scopeOfWorkCount }}";
		// If deductionCount is also a variable you can do the same as above
		document.getElementById('number_of_deduction').value = "{{ order.deductionCount }}";
	});
</script>



<script>


function termsAmountCalculation() {
  var selection = document.getElementById('terms-selection');
  var selectedOption = selection.options[selection.selectedIndex];

  // Get the percentage either from the dropdown or from the custom input
  var percentageInput = document.getElementById('terms-percentage-cell').value;
  var percentageString = percentageInput !== '' ? percentageInput : selectedOption.getAttribute('data-percentage-amount');
  
  // Remove any non-numeric characters (e.g., '%') and parse the percentage
  var cleanedPercentageString = percentageString.replace('%', '');
  var percentageNumber = parseFloat(cleanedPercentageString) / 100;

  // Retrieve the grand total value
  var grTotalCell = document.getElementById('grand-total-payment').querySelector('input').value;
  var grValue = parseFloat(grTotalCell) || 0;

  // Calculate and update the terms amount
  var calculatedAmount = percentageNumber * grValue;
  document.getElementById('terms-amount-cell').querySelector('input').value = calculatedAmount.toFixed(2);
  document.getElementById('percentage-payment-type').querySelector('input').value= percentageString;

}

function taxAmountCalculation(){
  var selection = document.getElementById('tax-cell');
  var selectedOption = selection.options[selection.selectedIndex];

  // Get the percentage either from the dropdown or from the custom input
  var percentageInput = document.getElementById('tax-percentage-cell').value;
  var percentageString = percentageInput !== '' ? percentageInput : selectedOption.getAttribute('data-percentage-amount');
  
  // Remove any non-numeric characters (e.g., '%') and parse the percentage
  var cleanedPercentageString = percentageString.replace('%', '');
  var percentageNumber = parseFloat(cleanedPercentageString) / 100;

  // Retrieve the grand total value
  var grTotalCell = document.getElementById('grand-total-payment').querySelector('input').value;
  var grValue = parseFloat(grTotalCell) || 0;

  // Calculate and update the terms amount
  var calculatedAmount = percentageNumber * grValue;
  document.getElementById('tax-amount-cell').querySelector('input').value = calculatedAmount.toFixed(2);
}

function addDeduction(){
  var paymentTable = document.getElementById('payment-table')
  var deductionRow = document.getElementById('deduction-row')
  var rowIdx = deductionRow.rowIndex
  var newRow = paymentTable.insertRow(rowIdx +1)
  var number_of_deduction = document.getElementById('number_of_deduction'); 
  var currentCount = parseInt(number_of_deduction.value, 10) || 0; 
  number_of_deduction.value = currentCount + 1;

  for (i = 0 ; i < 5 ; i++){
	var cell = newRow.insertCell(i);
	if (i == 0){
		var selection = document.createElement('select')
		selection.name = "deduction_" + currentCount.toString()
		var option1 = document.createElement("option");
		option1.value = "deduction";
		option1.text = "DEDUCTION";
		selection.appendChild(option1);

		var option2 = document.createElement("option");
		option2.value = "addition";
		option2.text = "ADDITION";
		selection.appendChild(option2);
		cell.appendChild(selection)
	}
	if (i == 1){
		var percentage_cell = document.createElement('input')
		percentage_cell.type = 'text'
		percentage_cell.name = 'deduction-percentage_' +currentCount.toString()
		percentage_cell.style.display = 'none'
		cell.appendChild(percentage_cell)
	}
	if (i == 2){
		var amount_cell = document.createElement('input')
		amount_cell.type = 'text'
		amount_cell.name = 'ded-addition-amount-cell_' + currentCount.toString()
		amount_cell.id = 'ded-addition-amount-cell_' + currentCount.toString()
		amount_cell.value = 0
		cell.appendChild(amount_cell)
		
	}
	if (i == 3){
		var remarks_cell = document.createElement('input')
		remarks_cell.type = 'text'
		remarks_cell.name = 'deduction-remarks_' + currentCount.toString()
		cell.style.textAlign = 'left'
		cell.appendChild(remarks_cell)
	}
	if (i == 4) {
		var removeButton = document.createElement("button");
		removeButton.id = "removeRowDed"
		removeButton.className = "button add-new-button removeRowDed"
		removeButton.style.width = "25px"
		removeButton.textContent = "-"
		cell.appendChild(removeButton)
	}
	number_of_deduction.value = (currentCount + 1).toString(); // Increment after the loop 
 }
}

// CHANGING THE TERMS SELECTION CELL

document.getElementById('terms-selection').onchange = function(){
  if (this.value == "CREATE") {
    var customInput = document.createElement("input");
    customInput.type = "text";
    customInput.name = "terms-percentage-cell"; // Using the same name for consistency
    customInput.id = "custom-terms-percentage-cell"; // Giving an ID for easier access
	customInput.textContent = ''

    // Hide the dropdown
    this.style.display = "none";

    // Insert the new input field after the dropdown
    this.parentNode.insertBefore(customInput, this.nextSibling);
	}
  var percentageAmount = this.options[this.selectedIndex].getAttribute('data-percentage-amount');
  document.getElementsByName('terms-percentage-cell')[0].value = percentageAmount;
  document.getElementById('payment-type').querySelector('input').value= this.value;
}
function addUppercaseListener(element) {
  element.addEventListener('input', function() {
    this.value = this.value.toUpperCase();
  });
}

document.getElementById('bank').onchange = function() {
  if (this.value == "CREATE") {
    var customInput = document.createElement("input");
    customInput.type = "text";
    customInput.name = "bank";
    customInput.id = "bank_custom"; // Use a different ID to avoid conflicts

    // Add the uppercase listener to the new input
    addUppercaseListener(customInput);

    this.style.display = "none";
    this.parentNode.insertBefore(customInput, this.nextSibling);
  }
};

document.getElementById('customer').onchange = function() {
  if (this.value == "CREATE") {
    var customInput = document.createElement("input");
    customInput.type = "text";
    customInput.name = "customer";
    customInput.id = "customer_custom"; // Use a different ID to avoid conflicts

    // Add the uppercase listener to the new input
    addUppercaseListener(customInput);

    this.style.display = "none";
    this.parentNode.insertBefore(customInput, this.nextSibling);
  }
};

document.getElementById('region').onchange = function() {
  if (this.value == "CREATE") {
    var customInput = document.createElement("input");
    customInput.type = "text";
    customInput.name = "region";
    customInput.id = "region_custom"; // Use a different ID to avoid conflicts

    // Add the uppercase listener to the new input
    addUppercaseListener(customInput);

    this.style.display = "none";
    this.parentNode.insertBefore(customInput, this.nextSibling);
  }
};

// CHANGING THE TAX SELECTION CELL
document.getElementById('tax-cell').onchange = function(){
  var percentageAmount = this.options[this.selectedIndex].getAttribute('data-tax-percentage-amount');
  document.getElementsByName('tax-percentage-cell')[0].value = percentageAmount;
}

document.addEventListener('input', function(event) {
	updateTotals()
	termsAmountCalculation()
	taxAmountCalculation()
	updateGrandTotal()

});
document.addEventListener('change', function(event) {
	updateTotals()
	termsAmountCalculation()
	taxAmountCalculation()
	updateGrandTotal()
});

document.addEventListener('DOMContentLoaded', function() {
  // Function to update the total price for BoQ
  function updateTotalBoq(rowNum) {
    var qtyB = document.querySelector('input[name="qtyB_' + rowNum + '"]').value || 0;
    var unitPrice = document.querySelector('input[name="unitPrice_' + rowNum + '"]').value || 0;
    var totalBoqElement = document.querySelector('input[name="totalB_' + rowNum + '"]');
    totalBoqElement.value = parseInt(qtyB) * parseFloat(unitPrice);
  }

  // Function to update the total price for Actual
  function updateTotalActual(rowNum) {
    var qtyA = document.querySelector('input[name="qtyA_' + rowNum + '"]').value || 0;
    var unitPrice = document.querySelector('input[name="unitPrice_' + rowNum + '"]').value || 0;
    var totalActualElement = document.querySelector('input[name="totalA_' + rowNum + '"]');
    totalActualElement.value = parseInt(qtyA) * parseFloat(unitPrice);
  }

  // Attach change event listeners to select elements and inputs for quantity and unit price
  document.querySelectorAll('.line-items-container').forEach(function(element) {
    element.addEventListener('change', function(event) {
      var name = event.target.name;
      var rowNum = name.split('_')[1];
      
      if (name.startsWith('scopeOfWork')) {
        // If the changed element is a 'scopeOfWork' select
        var selectedOption = event.target.options[event.target.selectedIndex];
        var unitPriceElement = document.querySelector('input[name="unitPrice_' + rowNum + '"]');
        unitPriceElement.value = selectedOption.getAttribute('data-price');
        // Update both BoQ and Actual totals
        updateTotalBoq(rowNum);
        updateTotalActual(rowNum);
        updateTotals()
	    termsAmountCalculation()
	    taxAmountCalculation()
	    updateGrandTotal()
      } else if (name.startsWith('qtyB') || name.startsWith('unitPrice')) {
        // If the changed element is quantity BoQ or unit price input
        updateTotalBoq(rowNum);
        updateTotalActual(rowNum);
        updateTotals()
        termsAmountCalculation()
        taxAmountCalculation()
        updateGrandTotal()
      } else if (name.startsWith('qtyA')|| name.startsWith('unitPrice')) {
        // If the changed element is quantity Actual input
        updateTotalActual(rowNum);
        	updateTotals()
	    termsAmountCalculation()
	    taxAmountCalculation()
	    updateGrandTotal()
      }
    });
  });
});

function updateGrandTotal() {
    var grandTotal = 0;

    // Select all input elements with an ID containing 'amount-cell'
    var amountInputs = document.querySelectorAll('input[id*="amount-cell"]');
    amountInputs.forEach(function(input) {
        // Parse the value of each input as a float and add it to the total
        var value = parseFloat(input.value) || 0;
        grandTotal += value;
    });

    // Update the grand total in the appropriate input field
	document.getElementById('grand-total-payment2').querySelector('input').value= grandTotal.toFixed(2);
	document.getElementById('amount-payment-type').querySelector('input').value= grandTotal.toFixed(2);

}

function updateTotals() {
	// Initialize the total variables
	var totalActual = 0;
	var totalBoq = 0;
	
	// Iterate through each row in the tbody
	var rows = document.querySelectorAll("#scopeOfWork tbody tr");
	rows.forEach(function(row) {
		// Assuming you have input fields in the 'Total (ACTUAL)' and 'Total (BOQ)' columns
		var actual = row.querySelector('[name^="totalA"]'); // Use the correct selector for your inputs
		var boq = row.querySelector('[name^="totalB"]'); // Use the correct selector for your inputs
		
		// Add the parsed values to the totals, ensuring they are numbers
		totalActual += actual ? parseFloat(actual.value) || 0 : 0;
		totalBoq += boq ? parseFloat(boq.value) || 0 : 0;
    
	});

	// Update the totals in the tfoot
	document.getElementById("grand-total-actual").querySelector('input').value = totalActual
	document.getElementById("grand-total-boq").querySelector('input').value = totalBoq
  document.getElementById("grand-total-payment").querySelector('input').value = totalBoq

}
function reIndexRows(tableId) {
  var table = document.getElementById(tableId);
  var rows = table.querySelectorAll('tbody tr');

  // Start from 0 since we're iterating over tbody rows directly
  rows.forEach(function(row, index) {
    var newIndex = index; // New index starts from 1
    row.dataset.index = newIndex; // Update the dataset index
    var numberCell = row.cells[0]; // Update the visible row number
    numberCell.textContent = newIndex + 1;

    // Update the names of all input/select elements
    var inputs = row.querySelectorAll('input, select');
    inputs.forEach(function(input) {
      var name = input.name;
      if (name) {
        // Replace the old index with the new one
        input.name = name.replace(/_\d+$/, '_' + newIndex);
      } 
    });
  });
}
function reIndexRowsDed(tableId) {
  var table = document.getElementById(tableId);
  var rows = table.querySelectorAll('tbody tr');

  // Start from 0 since we're iterating over tbody rows directly
  rows.forEach(function(row, index) {
    var newIndex = index; // New index starts from 1
    row.dataset.index = newIndex; // Update the dataset index


    // Update the names of all input/select elements
    var inputs = row.querySelectorAll('input, select');
    inputs.forEach(function(input) {
      var name = input.name;
      if (name) {
        // Replace the old index with the new one
        input.name = name.replace(/_\d+$/, '_' + newIndex);
      } 
    });
  });
}

// REMOVE BUTTON ON SCOPE OF WORK
document.addEventListener('DOMContentLoaded', (event) => {
	// Event delegation
    document.getElementById('scopeOfWork').addEventListener('click', function(event) {
        if (event.target && event.target.className.includes('removeRowButton')) {
        var row = event.target.closest('tr');
            if (row) {
                row.remove(); // Remove the row
                reIndexRows('scopeOfWork'); // Re-index rows after removal
                number_of_scopes = document.getElementById('number_of_scopes')
                number_of_scopes.value -= 1
                updateTotals()
                termsAmountCalculation()
                taxAmountCalculation()
                updateGrandTotal()
            }
        }
    });
});

// REMOVE BUTTON ON DEDUCTION
document.addEventListener('DOMContentLoaded', (event) => {
	// Event delegation
    document.getElementById('payment-table').addEventListener('click', function(event) {
        if (event.target && event.target.className.includes('removeRowDed')) {
        var row = event.target.closest('tr');
            if (row) {
                row.remove(); // Remove the row
                reIndexRows('deduction-row'); // Re-index rows after removal
                number_of_deduction = document.getElementById('number_of_deduction')
                number_of_deduction.value -= 1
                updateTotals()
                termsAmountCalculation()
                taxAmountCalculation()
                updateGrandTotal()
            }
        }
    });
});



function add() {
	var scopeOfWorkTable = document.getElementById("scopeOfWork");
	var tbody = scopeOfWorkTable.tBodies[0]
	var rows = tbody.rows.length;
	var r = tbody.insertRow(rows); // Insert the row at the end of this tbody
	var number_of_scopes = document.getElementById("number_of_scopes");
	var currentCount = parseInt(number_of_scopes.value, 10)
	number_of_scopes.value = currentCount + 1
    r.dataset.index = currentCount ;

	for (var i = 0; i < 9; i++) {
		var cell = r.insertCell(i);
		if (i == 0) {
			var num = r.insertCell(0)
			num.textContent = rows+1
			num.style.textAlign = "center";
			num.class = "line-items-container"

		}
		if (i == 1) {
			var selection = document.createElement("select");
			selection.name = "scopeOfWork_" + currentCount.toString()
			cell.style.textAlign = "left";
			selection.class = "line-items-container"
			// Add options to the sele5t element
			var option1 = document.createElement("option");
			option1.value = "Pulling Cable-24 core (AE) include install the Accessory";
			option1.setAttribute('data-price', 2500)
			option1.text = "Pulling Cable-24 core (AE) include install the Accessory";
			selection.appendChild(option1);

			var option2 = document.createElement("option");
			option2.value = "Pulling Cable-48 core (AE) include install the Accessory";
			option2.setAttribute('data-price', 2500)
			option2.text = "Pulling Cable-48 core (AE) include install the Accessory";
			selection.appendChild(option2);

			var option3 = document.createElement("option");
			option3.value = "Pulling Cable-96 core (AE) include install the Accessory";
			option3.setAttribute('data-price', 2500)
			option3.text = "Pulling Cable-96 core (AE) include install the Accessory";
			selection.appendChild(option3);

			var option4 = document.createElement("option");
			option4.value = "Pulling Cable-144 core (AE) include install the Accessory";
			option4.setAttribute('data-price', 3000)
			option4.text = "Pulling Cable-144 core (AE) include install the Accessory";
			selection.appendChild(option4);

			var option5 = document.createElement("option");
			option5.value = "Instal Label Cable (on pole, in Handhole)";
			option5.setAttribute('data-price', 2000)
			option5.text = "Instal Label Cable (on pole, in Handhole)";
			selection.appendChild(option5);

			var option6 = document.createElement("option");
			option6.value = "Instal Label FDT";
			option6.setAttribute('data-price', 2000)
			option6.text = "Instal Label FDT";
			selection.appendChild(option6);

			var option7 = document.createElement("option");
			option7.value = "Instal Label FAT";
			option7.setAttribute('data-price', 2000)
			option7.text = "Instal Label FAT";
			selection.appendChild(option7);

			var option8 = document.createElement("option");
			option8.value = "Instal Label Pole";
			option8.setAttribute('data-price', 2000)
			option8.text = "Instal Label Pole";
			selection.appendChild(option8);

			var option9 = document.createElement("option");
			option9.value = "Instal pole 7 & 9 meter 4 inch include the foundation";
			option9.setAttribute('data-price', 135000)
			option9.text = "Instal pole 7 & 9 meter 4 inch include the foundation";
			selection.appendChild(option9);

			var option10 = document.createElement("option");
			option10.value = "Instal pole 7 meter 3 inch include the foundation";
			option10.setAttribute('data-price', 130000)
			option10.text = "Instal pole 7 meter 3 inch include the foundation";
			selection.appendChild(option10);

			var option11 = document.createElement("option");
			option11.value = "Instal Cable Hanger";
			option11.setAttribute('data-price', 20000)
			option11.text = "Instal Cable Hanger";
			selection.appendChild(option11);

			var option12 = document.createElement("option");
			option12.value = "Instal sling Wire";
			option12.setAttribute('data-price', 2500)
			option12.text = "Instal sling Wire";
			selection.appendChild(option12);

			var option13 = document.createElement("option");
			option13.value = "Instal FDT";
			option13.setAttribute('data-price', 130000)
			option13.text = "Instal FDT";
			selection.appendChild(option13);

			var option14 = document.createElement("option");
			option14.value = "Instal FAT inclde the Splicing & Splitter";
			option14.setAttribute('data-price', 150000)
			option14.text = "Instal FAT inclde the Splicing & Splitter";
			selection.appendChild(option14);

			var option15 = document.createElement("option");
			option15.value = "Splicing";
			option15.setAttribute('data-price', 20000)
			option15.text = "Splicing";
			selection.appendChild(option15);

			// User create custom object 
			var option16 = document.createElement("option");
			option16.value = "Add Custom Scope Of Work";
			option16.text = "Add Custom Scope Of Work"
			selection.appendChild(option16)
			// Updating the unit price when selecting items
			selection.onchange = function() {
				var selectedOption = this.options[this.selectedIndex]
				var selectedPrice = selectedOption.getAttribute('data-price')
				var unitPriceInput = this.parentNode.parentNode.cells[4].querySelector('input');
				unitPriceInput.value = selectedPrice
				var totalBoqInput = this.parentNode.parentNode.cells[5].querySelector('input')
				var qty = this.parentNode.parentNode.cells[2].querySelector('input')
				var totalActualInput = this.parentNode.parentNode.cells[6].querySelector('input')
				var qtyActual = this.parentNode.parentNode.cells[3].querySelector('input')
				var grandTotalUpdater = document.getElementById('grand-total-payment')
				grandTotalUpdater.addEventListener('change', function(event){
					this.value = unitPriceInput.value * qty
				});
				if (qtyActual.value == 0){
						totalActualInput.value = ''
					}
					else {
						totalActualInput.value = qtyActual.value * unitPriceInput.value
					}
				if (this.value == "Add Custom Scope Of Work") {
					var customInput = document.createElement("input");
					this.style.display = "none"
					customInput.type = "text"
					customInput.name = "scopeOfWork_" + currentCount.toString()
					applyStyles(customInput, "text")
					this.parentNode.insertBefore(customInput, this.nextSibling);
					
				}
				qty.addEventListener('input', function(event) {
					totalBoqInput.value = this.value * unitPriceInput.value
				});
				unitPriceInput.addEventListener('input', function(event) {
					totalBoqInput.value = this.value * qty.value
				});
				totalBoqInput.value = unitPriceInput.value * qty.value;

				// Total Actual
				qtyActual.addEventListener('input', function(event) {
					if (this.value == 0){
						totalActualInput.value = ''
					}
					else {
						totalActualInput.value = this.value * unitPriceInput.value
					}
				});
				unitPriceInput.addEventListener('input', function(event) {
					if (qtyActual.value == 0){
						totalActualInput.value = ''
					}
					else {
						totalActualInput.value = this.value * qtyActual.value
					}
				});
			};
			cell.appendChild(selection);
		}
		if (i == 2) {
			var num = document.createElement("input");
			num.name = "qtyB_" + currentCount.toString()
			num.type = "number";
			num.class = "line-items-container"

			cell.appendChild(num);
		}
		if (i == 3) {
			var num1 = document.createElement("input");
			num1.name = "qtyA_" + currentCount.toString()
			num1.type = "number";
			num1.class = "line-items-container"


			cell.appendChild(num1)
		}
		if (i == 4) { // Assuming first cell is for the row number or another widget
			var text = document.createElement("input");
			text.name = "unitPrice_" + currentCount.toString()
			text.class = "line-items-container"

			cell.appendChild(text);
		}
		if (i == 5) { // Assuming first cell is for the row number or another widget

            var text3 = document.createElement("input");
			text3.name = "totalB_" + currentCount.toString()
			text3.class = "line-items-container"

			cell.appendChild(text3);
		}
		if (i == 6) { // Assuming first cell is for the row number or another widget
			var text2 = document.createElement("input");
			text2.name = "totalA_" + currentCount.toString()
			text2.class = "line-items-container"

			cell.appendChild(text2);
		}
		if (i == 7) { // Assuming first cell is for the row number or another widget
			var text4 = document.createElement("input");
			text4.name = "remarks_" + currentCount.toString()
			text4.class = "line-items-container"
			cell.style.textAlign = "left"; // This will align the text inside the input
			cell.appendChild(text4);
		}
		if (i == 8){
			var removeButton = document.createElement("button");
			removeButton.id = "removeRow"
			removeButton.className = "button add-new-button removeRowButton"
			removeButton.class = "line-items-container"
			removeButton.textContent = "-"
			cell.appendChild(removeButton)
		}
	}
}
async function generatePDF(event) {
	event.preventDefault(); // Prevent the default form action
	const {
	jsPDF
	} = window.jspdf;

	// Get the form element
	const form = document.getElementById('workOrder'); // Replace with your actual form ID
	form.style.width = '100%';
	form.style.maxWidth = '100%';
	form.style.padding = "30";
	const tables = form.querySelectorAll('table');
	tables.forEach(table => {
		table.style.width = '100%'; // Ensure tables use the full width of the form
	table.style.maxWidth = '100%';
	});

	// Apply borders to the cells of the specific class table
	const tableCells = form.querySelectorAll('.line-items-container th, .line-items-container td');
	tableCells.forEach(cell => {
		cell.style.border = '1px solid black';
	});
	const workOrderTable = form.querySelectorAll('.scopeOfWork');
	workOrderTable.forEach(table => {
		table.style.borderCollapse = 'collapse';
	});

	// Apply borders to the cells of the specific class table
	const workOrderTableCells = form.querySelectorAll('.scopeOfWork th, .scopeOfWork td');
	workOrderTableCells.forEach(cell => {
		cell.style.border = '1px solid black';
	});
	const inputs = form.querySelectorAll('input');
	inputs.forEach(input => {
		const textSpan = document.createElement('span'); // Create a new span element
		textSpan.textContent = input.value; // Set the text content to the input's value
		textSpan.style.display = 'inline-block'; // Make sure the span is inline like an input
		textSpan.style.minWidth = input.offsetWidth + 'px'; // Set span's width to match input
		input.parentNode.replaceChild(textSpan, input); // Replace the input with the new span
	});
	// Hide the "+" button
	const addButton = form.querySelector('.add-new-button');
	if (addButton) {
		addButton.style.display = 'none';
	}

	// Replace selects with the selected text
	const selects = form.querySelectorAll('select');
	selects.forEach(select => {
		const selectedText = select.options[select.selectedIndex].text;
		const textNode = document.createTextNode(selectedText);
		select.parentNode.replaceChild(textNode, select);
	});
	const csrfTokenInput = form.querySelector('input[name="csrfmiddlewaretoken"]');
	if (csrfTokenInput) {
		csrfTokenInput.style.display = 'none';
	}

	const generatePDFButton = form.querySelector('generatePDFButton');
	if (generatePDFButton) {
		generatePDFButton.display.style = 'none';
	}
	// Capture the form as a canvas
	const canvas = await html2canvas(form, {
	scale: 1 // Start with a normal scale
	});

	const imgData = canvas.toDataURL('image/png');
	const imgWidth = canvas.width;
	const imgHeight = canvas.height;

	// Initialize jsPDF
	const pdf = new jsPDF('p', 'mm', 'a4');
	const pageWidth = pdf.internal.pageSize.getWidth();
	const pageHeight = pdf.internal.pageSize.getHeight();

	// Set desired margins (in mm)
	const marginLeft = 0;
	const marginRight = 0;
	const marginTop = 0;
	const marginBottom = 0;

	// Calculate the available space considering the margins
	const availableWidth = pageWidth - marginLeft - marginRight ;
	const availableHeight = pageHeight - marginTop - marginBottom;
	const horizontalScale = availableWidth / imgWidth;
	const verticalScale = availableHeight / imgHeight;
	const scale = Math.min(horizontalScale, verticalScale);

	// If the content height is less than page height, we can allow for a larger width.
	const finalScale = imgHeight * horizontalScale > availableHeight ? verticalScale : horizontalScale;

	// Calculate the scaled dimensions
	const scaledWidth = imgWidth * finalScale;
	const scaledHeight = imgHeight * finalScale;

	// Calculate centered positions
	const xCentered = (pageWidth - scaledWidth) / 2;
	const yCentered = (pageHeight - scaledHeight) / 2;

	// Add the image to the PDF, scaled and centered
	pdf.addImage(imgData, 'PNG', xCentered, yCentered, scaledWidth, scaledHeight);

	// Save the PDF
	pdf.save('form.pdf');
}

function applyStyles(element, type) {
	element.style.width = "100%"; // Make element take the full width of the cell
	element.style.height = "30px"; // Set a fixed height for a tighter look
	element.style.boxSizing = "border-box"; // Include padding and border in the width and height
	element.style.border = "1px solid #ddd"; // Uniform border style
	element.style.padding = "4px"; // Consistent padding
	element.style.margin = "0"; // Remove margins to avoid unnecessary spacing
}

document.getElementById('wo_date').addEventListener('input', function () {
// Extract the year and month from the date
var date = this.value;
var yearMonth = date ? date.substr(2, 2) + date.substr(5, 2) : '';

// Set the YYMM format to the 'shortdate' input field
document.getElementById('shortdate').value = yearMonth;
document.getElementById('date-payment-type').value = date
});
document.getElementById('wo_number').addEventListener('input', function () {
// Check if the input is not more than 4 digits and if it is within the 0-9999 range
if (this.value.length > 4 || parseInt(this.value, 10) > 9999) {
this.value = this.value.slice(0, 4); // Limit to the first 4 digits
}
});
document.getElementsByName('request_by')[0].addEventListener('input', function () {
this.value = this.value.toUpperCase();
});
document.getElementsByName('request_by')[0].addEventListener('input', function () {
this.value = this.value.toUpperCase();
});document.getElementsByName('city')[0].addEventListener('input', function () {
this.value = this.value.toUpperCase();
});document.getElementsByName('account_name')[0].addEventListener('input', function () {
this.value = this.value.toUpperCase();
});document.getElementsByName('category')[0].addEventListener('input', function () {
this.value = this.value.toUpperCase();
});document.getElementsByName('project')[0].addEventListener('input', function () {
this.value = this.value.toUpperCase();
});document.getElementsByName('account_number')[0].addEventListener('input', function () {
this.value = this.value.toUpperCase();
});document.getElementsByName('phone_number')[0].addEventListener('input', function () {
this.value = this.value.toUpperCase();
});document.getElementsByName('npwp')[0].addEventListener('input', function () {
this.value = this.value.toUpperCase();
});document.getElementsByName('clusterName')[0].addEventListener('input', function () {
this.value = this.value.toUpperCase();
});document.getElementsByName('siteId')[0].addEventListener('input', function () {
this.value = this.value.toUpperCase();
});document.getElementsByName('type')[0].addEventListener('input', function () {
this.value = this.value.toUpperCase();
});document.getElementsByName('workType')[0].addEventListener('input', function () {
this.value = this.value.toUpperCase();
});

</script>

{% endblock %}
